<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - TuronMarket</title>
    <link rel="icon" href="./ChatGPT Image 28 мая 2025 г., 22_39_24.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="payment.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg fixed-top">
            <div class="container">
                <a class="navbar-brand" href="index.html">🇺🇸TuronMarket🇺🇿</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="products.html">Products</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contacts.html">Contact us</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="know-the-price.html">Know the price</a>
                        </li>
                    </ul>

                    <div class="d-flex align-items-center">
                        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                            <i class="fas fa-moon"></i> Dark-mode
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="payment-container">
            <div class="payment-card">
                <div class="payment-header">
                    <h1><i class="fas fa-credit-card"></i> Payment</h1>
                    <p>Complete your purchase securely</p>
                </div>

                <div class="payment-summary">
                    <div class="summary-row">
                        <span><i class="fas fa-shopping-bag"></i> Subtotal:</span>
                        <span id="subtotalAmount">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span><i class="fas fa-percentage"></i> Advance Payment (30%):</span>
                        <span id="advanceAmount">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span><i class="fas fa-truck"></i> Delivery:</span>
                        <span>Free</span>
                    </div>
                    <div class="summary-row">
                        <span class="total-amount"><i class="fas fa-dollar-sign"></i> Total to Pay:</span>
                        <span class="total-amount" id="totalAmount">$0.00</span>
                    </div>
                </div>

                <div class="payment-methods">
                    <h4 style="margin-bottom: 1rem;"><i class="fas fa-payment"></i> Choose Payment Method</h4>
                    
                    <div class="payment-method" onclick="selectPaymentMethod('card')">
                        <i class="fas fa-credit-card"></i>
                        <div class="method-info">
                            <h5>Credit/Debit Card</h5>
                            <p>Pay securely with your card</p>
                        </div>
                    </div>

                    <div class="payment-method" onclick="selectPaymentMethod('paypal')">
                        <i class="fab fa-paypal"></i>
                        <div class="method-info">
                            <h5>PayPal</h5>
                            <p>Pay with your PayPal account</p>
                        </div>
                    </div>

                    <div class="payment-method" onclick="selectPaymentMethod('bank')">
                        <i class="fas fa-university"></i>
                        <div class="method-info">
                            <h5>Bank Transfer</h5>
                            <p>Direct bank transfer</p>
                        </div>
                    </div>

                    <div class="payment-method" onclick="selectPaymentMethod('crypto')">
                        <i class="fab fa-bitcoin"></i>
                        <div class="method-info">
                            <h5>Cryptocurrency</h5>
                            <p>Pay with Bitcoin or other crypto</p>
                        </div>
                    </div>
                </div>

                <!-- Card Details Form -->
                <div class="card-details" id="cardDetails">
                    <h5><i class="fas fa-credit-card"></i> Card Information</h5>
                    <form id="cardForm">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="cardNumber" class="form-label">Card Number</label>
                                <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="cvv" class="form-label">CVV</label>
                                <input type="text" class="form-control" id="cvv" placeholder="123" maxlength="4">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cardName" class="form-label">Cardholder Name</label>
                                <input type="text" class="form-control" id="cardName" placeholder="John Doe">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="expMonth" class="form-label">Month</label>
                                <select class="form-control" id="expMonth">
                                    <option value="">MM</option>
                                    <option value="01">01</option>
                                    <option value="02">02</option>
                                    <option value="03">03</option>
                                    <option value="04">04</option>
                                    <option value="05">05</option>
                                    <option value="06">06</option>
                                    <option value="07">07</option>
                                    <option value="08">08</option>
                                    <option value="09">09</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="expYear" class="form-label">Year</label>
                                <select class="form-control" id="expYear">
                                    <option value="">YY</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                    <option value="32">32</option>
                                    <option value="33">33</option>
                                    <option value="34">34</option>
                                    <option value="35">35</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>

                <button class="pay-button" id="payButton" onclick="processPayment()" disabled>
                    <i class="fas fa-lock"></i> Complete Payment
                </button>

                <div class="security-info">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <strong>Secure Payment</strong>
                        <p style="margin: 0; font-size: 0.9rem;">Your payment information is encrypted and secure</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h5>Processing Payment...</h5>
            <p>Please wait while we process your payment securely.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        let selectedPaymentMethod = null;
        let paymentAmount = 0;

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');

            body.classList.toggle('dark-theme');

            if (body.classList.contains('dark-theme')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i> Light-mode';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i> Dark-mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.getElementById('themeToggle');

            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                if (themeToggle) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i> Light-mode';
                }
            }
        }

        // Load payment information from localStorage
        function loadPaymentInfo() {
            const paymentData = JSON.parse(localStorage.getItem('paymentData'));
            
            if (paymentData) {
                const subtotal = paymentData.subtotal || 0;
                const advance = paymentData.advancePayment || (subtotal * 0.3);
                
                document.getElementById('subtotalAmount').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('advanceAmount').textContent = `$${advance.toFixed(2)}`;
                document.getElementById('totalAmount').textContent = `$${advance.toFixed(2)}`;
                
                paymentAmount = advance;
            } else {
                // If no payment data, redirect back to cart
                showNotification('No payment information found. Redirecting to cart...', 'warning');
                setTimeout(() => {
                    window.location.href = 'cart.html';
                }, 2000);
            }
        }

        // Select payment method
        function selectPaymentMethod(method) {
            // Remove active class from all methods
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('active');
            });

            // Add active class to selected method
            event.currentTarget.classList.add('active');
            selectedPaymentMethod = method;

            // Show/hide card details
            const cardDetails = document.getElementById('cardDetails');
            if (method === 'card') {
                cardDetails.classList.add('active');
            } else {
                cardDetails.classList.remove('active');
            }

            // Enable pay button
            updatePayButton();
        }

        // Update pay button state
        function updatePayButton() {
            const payButton = document.getElementById('payButton');
            
            if (selectedPaymentMethod) {
                payButton.disabled = false;
                payButton.innerHTML = `<i class="fas fa-lock"></i> Pay $${paymentAmount.toFixed(2)} Now`;
            } else {
                payButton.disabled = true;
                payButton.innerHTML = '<i class="fas fa-lock"></i> Select Payment Method';
            }
        }

        // Format card number input
        document.getElementById('cardNumber')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || '';
            if (formattedValue !== e.target.value) {
                e.target.value = formattedValue;
            }
        });

        // Format CVV input
        document.getElementById('cvv')?.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });

        // Process payment
        async function processPayment() {
            if (!selectedPaymentMethod) {
                showNotification('Please select a payment method', 'warning');
                return;
            }

            // Validate card details if card payment is selected
            if (selectedPaymentMethod === 'card') {
                if (!validateCardForm()) {
                    return;
                }
            }

            // Show loading overlay
            document.getElementById('loadingOverlay').style.display = 'flex';

            try {
                // Simulate payment processing
                await new Promise(resolve => setTimeout(resolve, 3000));

                // Simulate random success/failure for demo
                const isSuccess = Math.random() > 0.2; // 80% success rate

                if (isSuccess) {
                    // Payment successful
                    localStorage.removeItem('paymentData');
                    localStorage.removeItem('cart');
                    
                    showNotification('Payment successful! Your order has been confirmed.', 'success');
                    
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                } else {
                    // Payment failed
                    throw new Error('Payment processing failed');
                }
            } catch (error) {
                console.error('Payment error:', error);
                showNotification('Payment failed. Please try again or use a different payment method.', 'error');
            } finally {
                // Hide loading overlay
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        // Validate card form
        function validateCardForm() {
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            const cvv = document.getElementById('cvv').value;
            const cardName = document.getElementById('cardName').value.trim();
            const expMonth = document.getElementById('expMonth').value;
            const expYear = document.getElementById('expYear').value;

            if (!cardNumber || cardNumber.length < 13) {
                showNotification('Please enter a valid card number', 'warning');
                return false;
            }

            if (!cvv || cvv.length < 3) {
                showNotification('Please enter a valid CVV', 'warning');
                return false;
            }

            if (!cardName) {
                showNotification('Please enter the cardholder name', 'warning');
                return false;
            }

            if (!expMonth || !expYear) {
                showNotification('Please enter the card expiry date', 'warning');
                return false;
            }

            return true;
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const toastHTML = `
                <div class="position-fixed top-0 end-0 p-3" style="z-index: 1050">
                    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'info' ? 'info-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'} text-${type === 'error' ? 'danger' : type} me-2"></i>
                            <strong class="me-auto">🇺🇸TuronMarket🇺🇿</strong>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body">
                            ${message}
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', toastHTML);

            // Auto remove after 5 seconds
            setTimeout(() => {
                const toasts = document.querySelectorAll('.toast');
                toasts.forEach(toast => {
                    if (toast.querySelector('.toast-body').textContent.trim() === message) {
                        toast.remove();
                    }
                });
            }, 5000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadPaymentInfo();
            
            // Add scroll effect to navbar
            window.addEventListener('scroll', function () {
                const navbar = document.querySelector('.navbar');
                if (window.scrollY > 50) {
                    navbar.style.background = document.body.classList.contains('dark-theme')
                        ? 'rgba(52, 58, 64, 0.98)'
                        : 'rgba(255, 255, 255, 0.98)';
                } else {
                    navbar.style.background = document.body.classList.contains('dark-theme')
                        ? 'rgba(52, 58, 64, 0.95)'
                        : 'rgba(255, 255, 255, 0.95)';
                }
            });
        });
    </script>
</body>

</html>